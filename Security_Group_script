#! /usr/local/bin/aws

read -p "enter the security_group id: " sg_id

IP=`curl -s http://whatismyip.akamai.com/`
ip_range=`aws ec2 describe-security-groups --group-ids $sg_id --output text | grep -A 1 "80" | grep -i IPRANGES | awk '{print $2}'`
if [ -n $ip_range ]; then
aws ec2 revoke-security-group-ingress --group-id $sg_id --protocol tcp --port 80 --cidr $ip_range
aws ec2 authorize-security-group-ingress --group-id $sg_id --protocol tcp --port 80 --cidr $IP/32
else
aws ec2 authorize-security-group-ingress --group-id $sg_id --protocol tcp --port 80 --cidr $IP/32
fi
